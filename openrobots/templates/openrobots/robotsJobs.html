{% extends 'openrobots/base.html' %}
{% load static %}
{% block content %}
{% csrf_token %}
<script src="https://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="{% static "js/d3js_graphics/pie_donuts_3d.js"%}"></script>

<style>
    .shadow {
        -webkit-filter: drop-shadow( 0px 3px 3px rgba(0,0,0,.5) );
        filter: drop-shadow( 0px 3px 3px rgba(0,0,0,.5) );
    }
</style>


{% if error_message %}
    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-7 col-sm-offset-3">
            <div class="panel panel-danger">
                <div class="panel-heading"><h3 style="text-align:center">Error when requesting Robot jobs</h3> </div>
                <div class="panel-body">
                    {% for values in error_message %}
                        <h4>{{values}}</h4>
                    {% endfor %}
                </div> <!--  end of panel body -->
            </div> <!--  end of panel  -->
        </div> <!--  end of col-sm-7 -->
    </div> <!--  end of row -->
{% endif %}

{% if display_robot_utilization %}
    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-7 col-sm-offset-3">
            <div class="panel panel-danger">
                <div class="panel-heading"><h3 style="text-align:center">grafica</h3> </div>
                <div class="panel-body">
                    {% for values in error_message %}
                        <h4>{{values}}</h4>
                    {% endfor %}
                </div> <!--  end of panel body -->
            </div> <!--  end of panel  -->
        </div> <!--  end of col-sm-7 -->
    </div> <!--  end of row -->

    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-12" >
            <div class="panel panel-default">
                <div class="panel-heading"><h3>Robot Utilization</h3> </div>
                {% for key, values in display_robot_utilization.items %}
                    <div class="panel-body">
                        <h4 style="text-align:center">Robot {{key}}</h4>
                        <table class="table table-hover">
                            <thead>
                                <th>Action</th>
                                <th>Start Date</th>
                                <th>Finish Date</th>
                                <th>Execution Duration</th>
                            </thead>
                            <tbody>
                                    {%for action, s_date, f_date, time in values.robot_actions %}
                                        <tr>
                                            <td>{{action}}</td>
                                            <td>{{s_date}}</td>
                                            <td>{{f_date}}</td>
                                            <td>{{time}}</td>
                                        </tr>
                                    {% endfor %}
                            </tbody>
                        </table>


                    </div> <!--  end of panel body -->
                {% endfor %}
            </div> <!--  end of panel  -->
        </div> <!--  end of col-sm-12 -->
    </div> <!--  end of row -->
{% else %}
    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-7 col-sm-offset-3" >
            <div class="panel panel-default">
                <div class="panel-heading"><h3>Robot Utilization</h3> </div>
                <div class="panel-body">
                    <form method="post" enctype="multipart/form-data" name="robotsjobs" id="robotsjobs" class="form-horizontal">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="robotsjobs"/>
                        <div class="form-group">
                            <label class="col-sm-5 control-label" for="stations" >Station Type</label>
                            <div class="col-sm-6"><select class="form-control"  name="stations" id="stations">
                                                    <option value="">Choose a value</option>
                                                    {% for value in form_data.stations %}
                                                        <option value="{{value}}">{{value}}</option>
                                                    {% endfor %}
                                              </select>
                            </div>  <!-- end select input -->
                        </div>  <!-- end from-group   -->
                        <div class="form-group">
                            <label class="col-sm-5 control-label" for="robots" >Robot Name</label>
                            <div class="col-sm-6"><select class="form-control"  name="robots" id="robots">
                                                    <option value="">Choose a value</option>
                                                    {% for value in form_data.robots %}
                                                        <option value="{{value}}">{{value}}</option>
                                                    {% endfor %}
                                              </select>
                            </div>  <!-- end select input -->
                        </div>  <!-- end from-group   -->
                        <div class="form-group">
                            <label class="col-sm-5 control-label" for="protocolsAction" >Executed Protocol</label>
                            <div class="col-sm-6"><select class="form-control"  name="protocolsAction" id="protocolsAction">
                                                    <option value="">Choose a value</option>
                                                    {% for value in form_data.protocols_action %}
                                                        <option value="{{value}}">{{value}}</option>
                                                    {% endfor %}
                                              </select>
                            </div>  <!-- end select input -->
                        </div>  <!-- end from-group   -->
                        <div class="form-group">
                            <label class="col-sm-5 control-label" for="startdate" >Start Date (DD-MM-YYYY)</label>
                            <div class="col-sm-5"><input class="form-control" type="date" name="startdate" id="startdate"></div>

                            <br><br>
                            <label class="col-sm-5 control-label" for="enddate" >End Date (DD-MM-YYYY)</label>
                            <div class="col-sm-5"><input class="form-control" type="date" name="enddate"  id="enddate"></div>
                        </div>  <!-- end from-group   -->
                        <input class="btn pull-right btn-primary" type="submit" value="Submit" id="btnSubmit">
                    </form> <!-- end form -->
                </div> <!--  end of panel body -->
            </div> <!--  end of panel  -->
        </div> <!--  end of col-sm-7 -->
    </div> <!--  end of row -->

    <script src="https://d3js.org/d3.v5.min.js"></script>

    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-7 col-sm-offset-3" >
            <div class="panel panel-default">
                <div class="panel-heading"><h3>Robot graphics</h3> </div>
                <div class="panel-body">

                        <div id="chart" width = "350" height = "300"></div>


                </div> <!--  end of panel body -->
            </div> <!--  end of panel  -->
        </div> <!--  end of col-sm-7 -->
    </div> <!--  end of row -->

    <script type="text/javascript" src="{% static "js/d3js_graphics/dj3_pie.js"%}"></script>
    <script>
        window.onload = my_pie({{data|safe}});
/*
var dataset = [
        { name: 'Direct', count: 2742 },
        { name: 'Facebook', count: 2242 },
        { name: 'Pinterest', count: 3112 },
        { name: 'Search', count: 937 },
        { name: 'Others', count: 1450 }
    ];
*/
/*
var dataset = {{data|safe}}

var total=0;

dataset.forEach(function(d){
    total+= d.count;
});
var pie_data=d3.pie()
            .value(function(d){return d.count})
            .sort(null);
var pie=d3.pie()
        .value(function(d){return d.count})
        .sort(null);
var w=300,h=300;
const adj = 60;

var outerRadiusArc=w/2;
var innerRadiusArc=100;
var shadowWidth=10;

var outerRadiusArcShadow=innerRadiusArc+1;
var innerRadiusArcShadow=innerRadiusArc-shadowWidth;


var color = d3.scaleOrdinal()
    .range(['#41B787', '#6352B9', '#B65480', '#D5735A', '#D7D9DA']);

//Create the svg and a group inside it.

var svg=d3.select("#chart")
    .append("svg")
    .attr('viewBox','-' + adj + ' -' + adj + ' ' + (w + adj) + ' ' + (h + adj ))
    .attr("width" , w)
    .attr("height" ,h)
    //.classed("shadow", true)
    .attr("class","shadow")
    .append("g")
    .attr("transform","translate("+w/2+","+h/2+")")
    ;

var createChart=function(svg,outerRadius,innerRadius,fillFunction,className){

  var arc=d3.arc()
          .innerRadius(outerRadius)
          .outerRadius(innerRadius);

    classString = '.' + className

    var path=svg.selectAll(classString).data(pie_data(dataset))
    .enter().append("path").attr("d",arc).attr("fill",fillFunction)
                .attr("class",className);


    path.transition()
            .duration(1000)
            .attrTween('d', function(d) {
                var interpolate = d3.interpolate({startAngle: 0, endAngle: 0}, d);
                return function(t) {
                    return arc(interpolate(t));
                };
            });

  var chart={path:path,arc:arc};

  return chart;
};



var mainChart=createChart(svg,outerRadiusArc,innerRadiusArc,function(d,i){
        return color(d.data.name);
    },'path1');

var shadowChart=createChart(svg,outerRadiusArcShadow,innerRadiusArcShadow,function(d,i){
        var c=d3.hsl(color(d.data.name));
        return d3.hsl((c.h+5), (c.s -.07), (c.l -.15));
    },'path2');


//Add text

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

var addText= function (text,y) {
    svg.append('text')
            .text(text)
            .attr("y",y)
            .attr("x",-35)
            ;
};

var restOfTheData=function(){

    addText(function(){
        return numberWithCommas(total);
    },0);


    addText(function(){
        return "Page View";
    },25);

};


setTimeout(restOfTheData,1000);
*/
</script>
{% endif %}

{% endblock %}
